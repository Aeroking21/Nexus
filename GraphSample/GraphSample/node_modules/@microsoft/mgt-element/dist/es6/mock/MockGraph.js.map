{"version":3,"file":"MockGraph.js","sourceRoot":"src/","sources":["mock/MockGraph.ts"],"names":[],"mappings":"AAAA;;;;;GAKG;;;;;;;;;;AAEH,OAAO,EACL,qBAAqB,EACrB,MAAM,EAEN,kBAAkB,EAElB,YAAY,EACZ,mBAAmB,EACnB,gBAAgB,EACjB,MAAM,mCAAmC,CAAC;AAC3C,OAAO,EAAE,YAAY,EAAE,gBAAgB,EAAE,MAAM,uBAAuB,CAAC;AAEvE,OAAO,EAAE,KAAK,EAAE,MAAM,UAAU,CAAC;AACjC,OAAO,EAAE,eAAe,EAAE,MAAM,uBAAuB,CAAC;AAGxD;;;;;;GAMG;AACH,iDAAiD;AACjD,MAAM,OAAO,SAAU,SAAQ,KAAK;IAClC,YAAY,YAA0B;QACpC,MAAM,UAAU,GAAiB;YAC/B,IAAI,qBAAqB,CAAC,YAAY,CAAC;YACvC,IAAI,YAAY,CAAC,IAAI,mBAAmB,EAAE,CAAC;YAC3C,IAAI,gBAAgB,EAAE;YACtB,IAAI,cAAc,EAAE;YACpB,IAAI,kBAAkB,EAAE;SACzB,CAAC;QAEF,KAAK,CACH,MAAM,CAAC,kBAAkB,CAAC;YACxB,UAAU,EAAE,eAAe,CAAC,GAAG,UAAU,CAAC;SAC3C,CAAC,CACH,CAAC;IACJ,CAAC;IAED;;;;;;OAMG;IACI,YAAY,CAAC,SAA2B;QAC7C,mGAAmG;QACnG,uGAAuG;QACvG,OAAO,IAAI,CAAC;IACd,CAAC;CACF;AAED;;;;;;GAMG;AACH,iDAAiD;AACjD,MAAM,cAAc;IAWlB;QACE,IAAI,gBAAgB,CAAC,gBAAgB,CAAC,EAAE;YACtC,IAAI,CAAC,QAAQ,GAAG,IAAI,YAAY,EAAE,CAAC;SACpC;IACH,CAAC;IAED,2CAA2C;IAC9B,OAAO,CAAC,OAAgB;;YACnC,IAAI;gBACF,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,UAAU,EAAE,CAAC;gBACxC,OAAO,CAAC,OAAO,GAAG,OAAO,GAAG,kBAAkB,CAAC,OAAO,CAAC,OAAiB,CAAC,CAAC;aAC3E;YAAC,OAAO,KAAK,EAAE;gBACd,eAAe;aAChB;YACD,OAAO,MAAM,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;QACrD,CAAC;KAAA;IACD;;;;;OAKG;IACI,OAAO,CAAC,IAAgB;QAC7B,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;IAC9B,CAAC;IAEa,UAAU;;;YACtB,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;gBAClB,MAAM,eAAe,GAAG,MAAA,IAAI,CAAC,QAAQ,0CAAE,OAAO,CAAC,aAAa,CAAC,CAAC;gBAC9D,IAAI,eAAe,EAAE;oBACnB,IAAI,CAAC,QAAQ,GAAG,eAAe,CAAC;iBACjC;qBAAM;oBACL,IAAI;wBACF,2DAA2D;wBAC3D,IAAI,QAAQ,GAAG,MAAM,KAAK,CAAC,6DAA6D,CAAC,CAAC;wBAC1F,IAAI,CAAC,QAAQ,GAAG,CAAC,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC,GAAG,OAAO,CAAC;qBACnD;oBAAC,WAAM;wBACN,8BAA8B;wBAC9B,IAAI,CAAC,QAAQ,GAAG,sDAAsD,CAAC;qBACxE;oBACD,MAAA,IAAI,CAAC,QAAQ,0CAAE,OAAO,CAAC,aAAa,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;iBACtD;aACF;YAED,OAAO,IAAI,CAAC,QAAQ,CAAC;;KACtB;CACF","sourcesContent":["/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport {\n  AuthenticationHandler,\n  Client,\n  Context,\n  HTTPMessageHandler,\n  Middleware,\n  RetryHandler,\n  RetryHandlerOptions,\n  TelemetryHandler\n} from '@microsoft/microsoft-graph-client';\nimport { SessionCache, storageAvailable } from '../utils/SessionCache';\nimport { MgtBaseComponent } from '../components/baseComponent';\nimport { Graph } from '../Graph';\nimport { chainMiddleware } from '../utils/GraphHelpers';\nimport { MockProvider } from './MockProvider';\n\n/**\n * MockGraph Instance\n *\n * @export\n * @class MockGraph\n * @extends {Graph}\n */\n// tslint:disable-next-line: max-classes-per-file\nexport class MockGraph extends Graph {\n  constructor(mockProvider: MockProvider) {\n    const middleware: Middleware[] = [\n      new AuthenticationHandler(mockProvider),\n      new RetryHandler(new RetryHandlerOptions()),\n      new TelemetryHandler(),\n      new MockMiddleware(),\n      new HTTPMessageHandler()\n    ];\n\n    super(\n      Client.initWithMiddleware({\n        middleware: chainMiddleware(...middleware)\n      })\n    );\n  }\n\n  /**\n   * Returns an instance of the Graph in the context of the provided component.\n   *\n   * @param {MgtBaseComponent} component\n   * @returns\n   * @memberof Graph\n   */\n  public forComponent(component: MgtBaseComponent): MockGraph {\n    // The purpose of the forComponent pattern is to update the headers of any outgoing Graph requests.\n    // The MockGraph isn't making real Graph requests, so we can simply no-op and return the same instance.\n    return this;\n  }\n}\n\n/**\n * Implements Middleware for the Mock Client to escape\n * the graph url from the request\n *\n * @class MockMiddleware\n * @implements {Middleware}\n */\n// tslint:disable-next-line: max-classes-per-file\nclass MockMiddleware implements Middleware {\n  /**\n   * @private\n   * A member to hold next middleware in the middleware chain\n   */\n  private _nextMiddleware: Middleware;\n\n  private _baseUrl: string;\n\n  private _session: SessionCache;\n\n  constructor() {\n    if (storageAvailable('sessionStorage')) {\n      this._session = new SessionCache();\n    }\n  }\n\n  // tslint:disable-next-line: completed-docs\n  public async execute(context: Context): Promise<void> {\n    try {\n      const baseUrl = await this.getBaseUrl();\n      context.request = baseUrl + encodeURIComponent(context.request as string);\n    } catch (error) {\n      // ignore error\n    }\n    return await this._nextMiddleware.execute(context);\n  }\n  /**\n   * Handles setting of next middleware\n   *\n   * @param {Middleware} next\n   * @memberof SdkVersionMiddleware\n   */\n  public setNext(next: Middleware): void {\n    this._nextMiddleware = next;\n  }\n\n  private async getBaseUrl() {\n    if (!this._baseUrl) {\n      const sessionEndpoint = this._session?.getItem('endpointURL');\n      if (sessionEndpoint) {\n        this._baseUrl = sessionEndpoint;\n      } else {\n        try {\n          // get the url we should be using from the endpoint service\n          let response = await fetch('https://cdn.graph.office.net/en-us/graph/api/proxy/endpoint');\n          this._baseUrl = (await response.json()) + '?url=';\n        } catch {\n          // fallback to hardcoded value\n          this._baseUrl = 'https://proxy.apisandbox.msdn.microsoft.com/svc?url=';\n        }\n        this._session?.setItem('endpointURL', this._baseUrl);\n      }\n    }\n\n    return this._baseUrl;\n  }\n}\n"]}