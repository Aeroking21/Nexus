{"version":3,"file":"graph.user.js","sourceRoot":"src/","sources":["graph/graph.user.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { IGraph, prepScopes, CacheItem, CacheService, CacheStore } from '@microsoft/mgt-element';\nimport { User } from '@microsoft/microsoft-graph-types';\n\nimport { findPeople, PersonType } from './graph.people';\nimport { schemas } from './cacheStores';\nimport { GraphRequest } from '@microsoft/microsoft-graph-client';\n\n/**\n * Object to be stored in cache\n */\nexport interface CacheUser extends CacheItem {\n  /**\n   * stringified json representing a user\n   */\n  user?: string;\n}\n\n/**\n * Object to be stored in cache\n */\nexport interface CacheUserQuery extends CacheItem {\n  /**\n   * max number of results the query asks for\n   */\n  maxResults?: number;\n  /**\n   * list of users returned by query\n   */\n  results?: string[];\n}\n\n/**\n * Defines the time it takes for objects in the cache to expire\n */\nexport const getUserInvalidationTime = (): number =>\n  CacheService.config.users.invalidationPeriod || CacheService.config.defaultInvalidationPeriod;\n\n/**\n * Whether or not the cache is enabled\n */\nexport const getIsUsersCacheEnabled = (): boolean =>\n  CacheService.config.users.isEnabled && CacheService.config.isEnabled;\n\nexport async function getUsers(graph: IGraph, userFilters: string = '', top: number = 10): Promise<User[]> {\n  let apiString = '/users';\n  let cache: CacheStore<CacheUserQuery>;\n  const cacheKey = userFilters === '' ? '*' : userFilters;\n  const cacheItem = { maxResults: top, results: null };\n\n  if (getIsUsersCacheEnabled()) {\n    cache = CacheService.getCache<CacheUserQuery>(schemas.users, schemas.users.stores.userFilters);\n    const cacheRes = await cache.getValue(cacheKey);\n    if (cacheRes && getUserInvalidationTime() > Date.now() - cacheRes.timeCached) {\n      return cacheRes.results.map(userStr => JSON.parse(userStr));\n    }\n  }\n  const graphClient: GraphRequest = graph.api(apiString).top(top);\n\n  if (userFilters) {\n    graphClient.filter(userFilters);\n  }\n\n  try {\n    const response = await graphClient.middlewareOptions(prepScopes('user.read')).get();\n    if (getIsUsersCacheEnabled() && response) {\n      cacheItem.results = response.value.map(userStr => JSON.stringify(userStr));\n      cache.putValue(userFilters, cacheItem);\n    }\n    return response.value;\n  } catch (error) {}\n}\n\n/**\n * async promise, returns Graph User data relating to the user logged in\n *\n * @returns {(Promise<User>)}\n * @memberof Graph\n */\nexport async function getMe(graph: IGraph, requestedProps?: string[]): Promise<User> {\n  let cache: CacheStore<CacheUser>;\n  if (getIsUsersCacheEnabled()) {\n    cache = CacheService.getCache<CacheUser>(schemas.users, schemas.users.stores.users);\n    const me = await cache.getValue('me');\n\n    if (me && getUserInvalidationTime() > Date.now() - me.timeCached) {\n      const cachedData = JSON.parse(me.user);\n      const uniqueProps = requestedProps\n        ? requestedProps.filter(prop => !Object.keys(cachedData).includes(prop))\n        : null;\n\n      // if requestedProps doesn't contain any unique props other than \"@odata.context\"\n      if (!uniqueProps || uniqueProps.length <= 1) {\n        return cachedData;\n      }\n    }\n  }\n\n  let apiString = 'me';\n  if (requestedProps) {\n    apiString = apiString + '?$select=' + requestedProps.toString();\n  }\n  const response = graph.api(apiString).middlewareOptions(prepScopes('user.read')).get();\n  if (getIsUsersCacheEnabled()) {\n    cache.putValue('me', { user: JSON.stringify(await response) });\n  }\n  return response;\n}\n\n/**\n * async promise, returns all Graph users associated with the userPrincipleName provided\n *\n * @param {string} userPrincipleName\n * @returns {(Promise<User>)}\n * @memberof Graph\n */\nexport async function getUser(graph: IGraph, userPrincipleName: string, requestedProps?: string[]): Promise<User> {\n  const scopes = 'user.readbasic.all';\n  let cache: CacheStore<CacheUser>;\n\n  if (getIsUsersCacheEnabled()) {\n    cache = CacheService.getCache<CacheUser>(schemas.users, schemas.users.stores.users);\n    // check cache\n    const user = await cache.getValue(userPrincipleName);\n\n    // is it stored and is timestamp good?\n    if (user && getUserInvalidationTime() > Date.now() - user.timeCached) {\n      const cachedData = user.user ? JSON.parse(user.user) : null;\n      const uniqueProps =\n        requestedProps && cachedData ? requestedProps.filter(prop => !Object.keys(cachedData).includes(prop)) : null;\n\n      // return without any worries\n      if (!uniqueProps || uniqueProps.length <= 1) {\n        return cachedData;\n      }\n    }\n  }\n\n  let apiString = `/users/${userPrincipleName}`;\n  if (requestedProps) {\n    apiString = apiString + '?$select=' + requestedProps.toString();\n  }\n\n  // else we must grab it\n  let response;\n  try {\n    response = await graph.api(apiString).middlewareOptions(prepScopes(scopes)).get();\n  } catch (_) {}\n\n  if (getIsUsersCacheEnabled()) {\n    cache.putValue(userPrincipleName, { user: JSON.stringify(response) });\n  }\n  return response;\n}\n\n/**\n * Returns a Promise of Graph Users array associated with the user ids array\n *\n * @export\n * @param {IGraph} graph\n * @param {string[]} userIds, an array of string ids\n * @returns {Promise<User[]>}\n */\nexport async function getUsersForUserIds(\n  graph: IGraph,\n  userIds: string[],\n  searchInput: string = '',\n  userFilters: string = ''\n): Promise<User[]> {\n  if (!userIds || userIds.length === 0) {\n    return [];\n  }\n  const batch = graph.createBatch();\n  const peopleDict = {};\n  const peopleSearchMatches = {};\n  const notInCache = [];\n  searchInput = searchInput.toLowerCase();\n  let cache: CacheStore<CacheUser>;\n\n  if (getIsUsersCacheEnabled()) {\n    cache = CacheService.getCache<CacheUser>(schemas.users, schemas.users.stores.users);\n  }\n\n  for (const id of userIds) {\n    peopleDict[id] = null;\n    let user = null;\n    if (getIsUsersCacheEnabled()) {\n      user = await cache.getValue(id);\n    }\n    if (user && getUserInvalidationTime() > Date.now() - user.timeCached) {\n      user = JSON.parse(user?.user);\n      const displayName = user?.displayName;\n\n      if (searchInput) {\n        const match = displayName && displayName.toLowerCase().includes(searchInput);\n        const searchMatches = match ? true : false;\n        if (searchMatches) {\n          peopleSearchMatches[id] = user ? user : null;\n        }\n      } else {\n        peopleDict[id] = user ? user : null;\n      }\n    } else if (id !== '') {\n      if (id.toString() === 'me') {\n        peopleDict[id] = await getMe(graph);\n      } else {\n        let apiUrl: string = `/users/${id}`;\n        if (userFilters) {\n          apiUrl += `${apiUrl}?$filter=${userFilters}`;\n        }\n        batch.get(id, apiUrl, ['user.readbasic.all']);\n        notInCache.push(id);\n      }\n    }\n  }\n  try {\n    if (batch.hasRequests) {\n      const responses = await batch.executeAll();\n      // iterate over userIds to ensure the order of ids\n      for (const id of userIds) {\n        const response = responses.get(id);\n        if (response && response.content) {\n          const user = response.content;\n          if (searchInput) {\n            const displayName = user?.displayName.toLowerCase();\n            if (displayName.contains(searchInput)) {\n              peopleSearchMatches[id] = user;\n            }\n          } else {\n            peopleDict[id] = user;\n          }\n\n          if (getIsUsersCacheEnabled()) {\n            cache.putValue(id, { user: JSON.stringify(user) });\n          }\n        }\n        if (searchInput && Object.keys(peopleSearchMatches).length) {\n          return Promise.all(Object.values(peopleSearchMatches));\n        }\n      }\n    }\n    return Promise.all(Object.values(peopleDict));\n  } catch (_) {\n    // fallback to making the request one by one\n    try {\n      // call getUser for all the users that weren't cached\n      userIds.filter(id => notInCache.includes(id)).forEach(id => (peopleDict[id] = getUser(graph, id)));\n      if (getIsUsersCacheEnabled()) {\n        // store all users that weren't retrieved from the cache, into the cache\n        userIds\n          .filter(id => notInCache.includes(id))\n          .forEach(async id => cache.putValue(id, { user: JSON.stringify(await peopleDict[id]) }));\n      }\n      return Promise.all(Object.values(peopleDict));\n    } catch (_) {\n      return [];\n    }\n  }\n}\n\n/**\n * Returns a Promise of Graph Users array associated with the people queries array\n *\n * @export\n * @param {IGraph} graph\n * @param {string[]} peopleQueries, an array of string ids\n * @returns {Promise<User[]>}\n */\nexport async function getUsersForPeopleQueries(graph: IGraph, peopleQueries: string[]): Promise<User[]> {\n  if (!peopleQueries || peopleQueries.length === 0) {\n    return [];\n  }\n\n  const batch = graph.createBatch();\n  const people = [];\n  let cacheRes: CacheUserQuery;\n  let cache: CacheStore<CacheUserQuery>;\n  if (getIsUsersCacheEnabled()) {\n    cache = CacheService.getCache<CacheUserQuery>(schemas.users, schemas.users.stores.usersQuery);\n  }\n\n  for (const personQuery of peopleQueries) {\n    if (getIsUsersCacheEnabled()) {\n      cacheRes = await cache.getValue(personQuery);\n    }\n\n    if (getIsUsersCacheEnabled() && cacheRes && getUserInvalidationTime() > Date.now() - cacheRes.timeCached) {\n      people.push(JSON.parse(cacheRes.results[0]));\n    } else if (personQuery !== '') {\n      batch.get(personQuery, `/me/people?$search=\"${personQuery}\"`, ['people.read'], {\n        'X-PeopleQuery-QuerySources': 'Mailbox,Directory'\n      });\n    }\n  }\n\n  try {\n    const responses = await batch.executeAll();\n\n    for (const personQuery of peopleQueries) {\n      const response = responses.get(personQuery);\n      if (response && response.content && response.content.value && response.content.value.length > 0) {\n        people.push(response.content.value[0]);\n        if (getIsUsersCacheEnabled()) {\n          cache.putValue(personQuery, { maxResults: 1, results: [JSON.stringify(response.content.value[0])] });\n        }\n      } else {\n        people.push(null);\n      }\n    }\n\n    return people;\n  } catch (_) {\n    try {\n      return Promise.all(\n        peopleQueries\n          .filter(personQuery => personQuery && personQuery !== '')\n          .map(async personQuery => {\n            const personArray = await findPeople(graph, personQuery, 1);\n            if (personArray && personArray.length) {\n              if (getIsUsersCacheEnabled()) {\n                cache.putValue(personQuery, { maxResults: 1, results: [JSON.stringify(personArray[0])] });\n              }\n              return personArray[0];\n            }\n          })\n      );\n    } catch (_) {\n      return [];\n    }\n  }\n}\n\n/**\n * Search Microsoft Graph for Users in the organization\n *\n * @export\n * @param {IGraph} graph\n * @param {string} query - the string to search for\n * @param {number} [top=10] - maximum number of results to return\n * @returns {Promise<User[]>}\n */\nexport async function findUsers(\n  graph: IGraph,\n  query: string,\n  top: number = 10,\n  userFilters: string = ''\n): Promise<User[]> {\n  const scopes = 'User.ReadBasic.All';\n  const item = { maxResults: top, results: null };\n  let cache: CacheStore<CacheUserQuery>;\n\n  if (getIsUsersCacheEnabled()) {\n    cache = CacheService.getCache<CacheUserQuery>(schemas.users, schemas.users.stores.usersQuery);\n    const result: CacheUserQuery = await cache.getValue(query);\n\n    if (result && getUserInvalidationTime() > Date.now() - result.timeCached) {\n      return result.results.map(userStr => JSON.parse(userStr));\n    }\n  }\n\n  let encodedQuery = `${query.replace(/#/g, '%2523')}`;\n  let graphBuilder = graph\n    .api('users')\n    .header('ConsistencyLevel', 'eventual')\n    .count(true)\n    .search(`\"displayName:${encodedQuery}\" OR \"mail:${encodedQuery}\"`);\n  let graphResult;\n\n  if (userFilters !== '') {\n    graphBuilder.filter(userFilters);\n  }\n  try {\n    graphResult = await graphBuilder.top(top).middlewareOptions(prepScopes(scopes)).get();\n  } catch {}\n\n  if (getIsUsersCacheEnabled() && graphResult) {\n    item.results = graphResult.value.map(userStr => JSON.stringify(userStr));\n    cache.putValue(query, item);\n  }\n  return graphResult ? graphResult.value : null;\n}\n\n/**\n * async promise, returns all matching Graph users who are member of the specified group\n *\n * @param {string} query\n * @param {string} groupId - the group to query\n * @param {number} [top=10] - number of people to return\n * @param {PersonType} [personType=PersonType.person] - the type of person to search for\n * @param {boolean} [transitive=false] - whether the return should contain a flat list of all nested members\n * @returns {(Promise<User[]>)}\n */\nexport async function findGroupMembers(\n  graph: IGraph,\n  query: string,\n  groupId: string,\n  top: number = 10,\n  personType: PersonType = PersonType.person,\n  transitive: boolean = false,\n  userFilters: string = '',\n  peopleFilters: string = ''\n): Promise<User[]> {\n  const scopes = ['user.read.all', 'people.read'];\n  const item = { maxResults: top, results: null };\n\n  let cache: CacheStore<CacheUserQuery>;\n  const key = `${groupId || '*'}:${query || '*'}:${personType}:${transitive}:${userFilters}`;\n\n  if (getIsUsersCacheEnabled()) {\n    cache = CacheService.getCache<CacheUserQuery>(schemas.users, schemas.users.stores.usersQuery);\n    const result: CacheUserQuery = await cache.getValue(key);\n\n    if (result && getUserInvalidationTime() > Date.now() - result.timeCached) {\n      return result.results.map(userStr => JSON.parse(userStr));\n    }\n  }\n\n  let filter: string = '';\n  if (query) {\n    filter = `startswith(displayName,'${query}') or startswith(givenName,'${query}') or startswith(surname,'${query}') or startswith(mail,'${query}') or startswith(userPrincipalName,'${query}')`;\n  }\n\n  let apiUrl: string = `/groups/${groupId}/${transitive ? 'transitiveMembers' : 'members'}`;\n  if (personType === PersonType.person) {\n    apiUrl += `/microsoft.graph.user`;\n  } else if (personType === PersonType.group) {\n    apiUrl += `/microsoft.graph.group`;\n    if (query) {\n      filter = `startswith(displayName,'${query}') or startswith(mail,'${query}')`;\n    }\n  }\n\n  if (userFilters) {\n    filter += query ? ` and ${userFilters}` : userFilters;\n  }\n\n  if (peopleFilters) {\n    filter += query ? ` and ${peopleFilters}` : peopleFilters;\n  }\n\n  const graphResult = await graph\n    .api(apiUrl)\n    .count(true)\n    .top(top)\n    .filter(filter)\n    .header('ConsistencyLevel', 'eventual')\n    .middlewareOptions(prepScopes(...scopes))\n    .get();\n\n  if (getIsUsersCacheEnabled() && graphResult) {\n    item.results = graphResult.value.map(userStr => JSON.stringify(userStr));\n    cache.putValue(key, item);\n  }\n\n  return graphResult ? graphResult.value : null;\n}\n\nexport async function findUsersFromGroupIds(\n  graph: IGraph,\n  query: string,\n  groupIds: string[],\n  top: number = 10,\n  personType: PersonType = PersonType.person,\n  transitive: boolean = false,\n  groupFilters: string = ''\n): Promise<User[]> {\n  const users: User[] = [];\n  for (let i = 0; i < groupIds.length; i++) {\n    const groupId = groupIds[i];\n    try {\n      const groupUsers = await findGroupMembers(graph, query, groupId, top, personType, transitive, groupFilters);\n      users.push(...groupUsers);\n    } catch (_) {\n      continue;\n    }\n  }\n  return users;\n}\n"]}