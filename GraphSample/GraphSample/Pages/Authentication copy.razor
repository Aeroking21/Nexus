<!-- Copyright (c) Microsoft Corporation.
     Licensed under the MIT license. -->

@page "/authentication/{action}/1"
@using Microsoft.AspNetCore.Components;
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication;

@* @import { Msal2Provider, Providers, ProviderState } from '@microsoft/mgt'; *@
<RemoteAuthenticatorView Action="@Action" LogInFailed="LogInFailedFragment" />


@code{
    
    [Parameter] public string? Action { get; set; }

    public Microsoft.AspNetCore.Components.RenderFragment UserProfile { get; set; }
    
    [Inject]
    protected IAccessTokenProvider AccessTokenProvider { get; set; }
    protected string AccessToken { get; private set; }
    protected override async Task OnInitializedAsync()
    {
        // Retrieve the access token
        var tokenResult = await AccessTokenProvider.RequestAccessToken();
        if (tokenResult.TryGetToken(out var accessToken))
        {
            AccessToken = accessToken.Value;
        }
    }

    private static RenderFragment LogInFailedFragment(string message)
    {
        return builder =>
        {
            builder.OpenElement(0, "div");
            builder.AddAttribute(1, "class", "alert alert-danger");
            builder.AddAttribute(2, "role", "alert");
            builder.OpenElement(3, "p");
            builder.AddContent(4, "There was an error trying to log you in.");
            builder.CloseElement();
            if (!string.IsNullOrEmpty(message))
            {
                builder.OpenElement(5, "p");
                builder.AddContent(6, $"Error: {message}");
                builder.CloseElement();
            }
            builder.CloseElement();
        };
    }


    // Configure the MGT provider with the access token
   // const mgtProvider = new Msal2Provider({
   // clientId: 'YOUR_CLIENT_ID',
   // scopes: ['user.read'], // Specify the required scopes for accessing Microsoft Graph API
    // Set the access token obtained from Microsoft.AspNetCore.Components.WebAssembly.Authentication
   // accessToken: 'YOUR_ACCESS_TOKEN',
   // });

    // Register the MGT provider
  //  Providers.globalProvider = mgtProvider;
}
